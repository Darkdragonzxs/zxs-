<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cloudmoon Game Loader</title>
<style>
body {
    margin: 0;
    background: #0b0b0b;
    font-family: "Inter", sans-serif;
    overflow: hidden;
}

iframe {
    width: 100vw;
    height: 100vh;
    border: none;
    position: relative;
    z-index: 1;
}

/* Logo */
#logo {
    position: fixed;
    top: 16px;
    left: 16px;
    width: 60px;
    z-index: 5000;
}

/* Liquid glass fullscreen overlay */
#fullscreenOverlay {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(18px) saturate(160%);
    -webkit-backdrop-filter: blur(18px) saturate(160%);
    background: rgba(25, 25, 25, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.05);
    z-index: 2000;
    color: #eaeaea;
    text-align: center;
    padding: 20px;
}

#fullscreenOverlay button,
#fullscreenOverlay select,
#fullscreenOverlay input {
    width: 260px;
    margin: 8px 0;
    padding: 12px;
    font-size: 15px;
    border-radius: 12px;
    border: none;
    outline: none;
    transition: 0.25s ease, transform 0.2s;
    color: white;
    cursor: pointer;
}

#fullscreenOverlay button {
    background: linear-gradient(145deg, rgba(72, 80, 90, 0.9), rgba(55, 60, 65, 0.8));
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: inset 0 0 6px rgba(255,255,255,0.1), 0 0 10px rgba(0,0,0,0.3);
}

#fullscreenOverlay button:hover {
    background: linear-gradient(145deg, rgba(90, 98, 108, 0.95), rgba(65, 70, 75, 0.85));
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.5);
}

#fullscreenOverlay input,
#fullscreenOverlay select {
    background: rgba(40, 40, 40, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: inset 0 0 6px rgba(0,0,0,0.4);
}

#dialogueBox {
    margin-top: 12px;
    padding: 12px 18px;
    width: 240px;
    font-size: 14px;
    background: rgba(50, 50, 50, 0.45);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(12px);
    color: #cfd4da;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

#statusMessage {
    margin-top: 20px;
    font-size: 17px;
    color: #aaa;
    transition: opacity 0.3s ease;
}

/* Loading bar */
#loadingBarContainer {
    width: 260px;
    height: 10px;
    background: rgba(200, 200, 200, 0.2);
    border-radius: 8px;
    overflow: hidden;
    margin-top: 20px;
    display: none;
}

#loadingBar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #aaa, #888);
    border-radius: 8px;
    transition: width 0.3s ease;
}
</style>
</head>
<body>
<img src="/assets/images/luna.png" alt=".LUNA Logo" id="logo">
<iframe src="https://zxs.comet.lat/cloudmoon/game/com.roblox.client/"></iframe>

<div id="fullscreenOverlay">
  <h2 id="titleText">Click Play</h2>

  <!-- Step 1 -->
  <button id="playBtn">Play</button>

  <!-- Step 2 -->
  <div id="serverSelectContainer" style="display:none;">
    <h3>Select Server</h3>
    <select id="serverSelect">
      <option>US West</option>
      <option>US East</option>
      <option>Europe</option>
      <option>Asia</option>
    </select>
    <button id="nextServer">Next</button>
  </div>

  <!-- Step 3 -->
  <div id="signInPasswordContainer" style="display:none;">
    <button id="signInPasswordBtn">Sign in with password</button>
  </div>

  <!-- Step 4 -->
  <div id="loginContainer" style="display:none;">
    <input type="text" placeholder="Google account email">
    <input type="password" placeholder="Password">
    <div id="dialogueBox">Make sure to use your Cloudmoon credentials.</div>
    <button id="confirmLogin">Sign in</button>
  </div>

  <!-- Step 5 (hidden during loading) -->
  <div id="clickPlayContainer" style="display:none;">
    <button id="clickPlayBtn">Click Play</button>
  </div>

  <!-- Step 6 (hidden during loading) -->
  <div id="finalPlayContainer" style="display:none;">
    <button id="finalPlayBtn">Play Game</button>
  </div>

  <div id="loadingBarContainer"><div id="loadingBar"></div></div>
  <div id="statusMessage"></div>
</div>

<script>
const steps = [
  "playBtn",
  "serverSelectContainer",
  "signInPasswordContainer",
  "loginContainer",
  "clickPlayContainer",
  "finalPlayContainer"
];

let currentStep = 0;
const overlay = document.getElementById("fullscreenOverlay");
const titleText = document.getElementById("titleText");
const statusMsg = document.getElementById("statusMessage");
const loadingBarContainer = document.getElementById("loadingBarContainer");
const loadingBar = document.getElementById("loadingBar");

function showStep(index) {
  steps.forEach((id, i) => {
    const el = document.getElementById(id);
    el.style.display = i === index ? "flex" : "none";
    if(el.tagName === "DIV") { el.style.flexDirection = "column"; el.style.alignItems = "center"; }
  });
  titleText.textContent = [
    "Click Play",
    "Select Server",
    "Click Sign in with Password",
    "Confirm Login",
    "Click Play",
    "Play Game"
  ][index];

  // hide loading if showing any step
  loadingBarContainer.style.display = "none";
  loadingBar.style.width = "0%";
}

function nextStep() {
  currentStep++;
  // After step 4 (login), show loading
  if(currentStep === 4) {
    startLoading();
  } else if(currentStep < steps.length) {
    showStep(currentStep);
  }
}

function startLoading() {
  // hide all buttons/containers
  steps.forEach(id => document.getElementById(id).style.display = "none");
  loadingBarContainer.style.display = "block";
  statusMsg.textContent = "Loading...";

  let duration = 3000 + Math.random() * 2000;
  let start = null;

  function animate(timestamp) {
    if(!start) start = timestamp;
    let progress = Math.min((timestamp - start) / duration, 1);
    loadingBar.style.width = progress * 100 + "%";
    if(progress < 1) requestAnimationFrame(animate);
    else {
      statusMsg.textContent = "Launch complete!";
      // After loading, reveal the next step (clickPlayContainer)
      currentStep++;
      showStep(currentStep);
    }
  }
  requestAnimationFrame(animate);
}

// Bind buttons
document.getElementById("playBtn").onclick = nextStep;
document.getElementById("nextServer").onclick = nextStep;
document.getElementById("signInPasswordBtn").onclick = nextStep;
document.getElementById("confirmLogin").onclick = nextStep;
document.getElementById("clickPlayBtn").onclick = nextStep;
document.getElementById("finalPlayBtn").onclick = nextStep;

// Start with first step
showStep(currentStep);
</script>
</body>
</html>
